#:kivy 2.1.0
#:import dp kivy.metrics.dp

#--- LoginScreen'in Görsel Tanımı ---
# İsteğiniz üzerine "Hoca/Veli" butonları eklendi.
<LoginScreen>:
    # FloatLayout, bileşenleri üst üste bindirmemizi sağlar.
    FloatLayout:
        #--- Arka Plan Tasarımı (Mevcut kodunuzdan alındı) ---
        canvas.before:
            # Dalgalı üst kısım için mavi renk
            Color:
                rgba: 3/255, 115/255, 252/255, 1
            RoundedRectangle:
                size: self.width, self.height * 0.6
                pos: 0, self.height * 0.4
                radius: [0, 0, dp(40), dp(40)]
            # Arka plandaki yarı saydam baloncuklar
            Color:
                rgba: 1, 1, 1, 0.1
            Ellipse:
                size: dp(50), dp(50)
                pos: self.width * 0.7, self.height * 0.85
            Ellipse:
                size: dp(80), dp(80)
                pos: self.width * 0.2, self.height * 0.7
            Ellipse:
                size: dp(30), dp(30)
                pos: self.width * 0.85, self.height * 0.65

        # YENİ: HOCA / VELİ SEÇİM BUTONLARI
        BoxLayout:
            orientation: 'horizontal'
            size_hint: 0.6, 0.08  # Ekranın %60 genişliğinde, %8 yüksekliğinde
            pos_hint: {'center_x': 0.5, 'top': 0.8} # Üst kısma konumlandırıldı
            spacing: dp(10)

            # ToggleButton'lar aynı 'group' içinde olduğunda, sadece biri seçili olabilir.
            ToggleButton:
                text: 'Öğretmen'
                group: 'role'
                state: 'down' # Başlangıçta 'Hoca' seçili olsun
                font_size: '18sp'
                color: (1,1,1,1) if self.state == 'down' else (1,1,1,0.7)
                background_color: (0,0,0,0)
                # DÜZELTME: selected_role property'sini günceller.
                on_press: root.selected_role = 'ogretmen'
                canvas.before:
                    Color:
                        # Seçili ise beyaz, değilse yarı saydam kenarlık
                        rgba: (1,1,1,1) if self.state == 'down' else (1,1,1,0.5)
                    Line:
                        width: 1.5
                        rounded_rectangle: self.x, self.y, self.width, self.height, dp(20)
            Label:
                text: '/'
                font_size: '36sp'
                size_hint_x: None
                width: dp(20)
                color: 1,1,1,0.7
            ToggleButton:
                text: 'Veli'
                group: 'role'
                font_size: '18sp'
                color: (1,1,1,1) if self.state == 'down' else (1,1,1,0.7)
                background_color: (0,0,0,0)
                # DÜZELTME: selected_role property'sini günceller.
                on_press: root.selected_role = 'veli'
                canvas.before:
                    Color:
                        rgba: (1,1,1,1) if self.state == 'down' else (1,1,1,0.5)
                    Line:
                        width: 1.5
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(20))

        #--- Beyaz Giriş Formu Kutusu (Mevcut kodunuzdan alındı) ---
        BoxLayout:
            orientation: 'vertical'
            padding: dp(25), dp(40), dp(25), dp(40)
            spacing: dp(15)
            size_hint: 0.9, 0.62
            pos_hint: {'center_x': 0.5, 'y': 0.05}
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [dp(20),]

            #--- Input Alanları ve Butonlar (Mevcut kodunuzdan alındı) ---
            TextInput:
                id: login
                hint_text: 'Kullanıcı Adı'
                size_hint_y: None
                height: dp(50)
                multiline: False
                background_color: 0,0,0,0
                foreground_color: 0.1, 0.1, 0.1, 1
                font_size: '16sp'
                cursor_color: 3/255, 115/255, 252/255, 1
                padding: [dp(15), (self.height - self.font_size)/2]
                canvas.after:
                    Color:
                        rgba: 0.8, 0.8, 0.8, 1
                    Line:
                        points: self.x, self.y, self.x + self.width, self.y
                        width: 1.2

            TextInput:
                id: password
                hint_text: 'Şifre'
                password: True
                size_hint_y: None
                height: dp(50)
                multiline: False
                background_color: 0,0,0,0
                foreground_color: 0.1, 0.1, 0.1, 1
                font_size: '16sp'
                cursor_color: 3/255, 115/255, 252/255, 1
                padding: [dp(15), (self.height - self.font_size)/2]
                canvas.after:
                    Color:
                        rgba: 0.8, 0.8, 0.8, 1
                    Line:
                        points: self.x, self.y, self.x + self.width, self.y
                        width: 1.2

            Widget:
                size_hint_y: 0.1

            Button:
                text: 'Giriş Yap'
                size_hint_y: None
                height: dp(50)
                background_color: 0,0,0,0
                background_normal: ''
                font_size: '18sp'
                # DÜZELTME: do_login metoduna selected_role'ü parametre olarak gönderiyoruz.
                on_release: root.do_login(login.text, password.text)
                canvas.before:
                    Color:
                        rgba: 3/255, 115/255, 252/255, 1
                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: [dp(10)]

            Label:
                text: 'ya da'
                color: 0.6, 0.6, 0.6, 1
                size_hint_y: None
                height: dp(35)

            Button:
                text: 'Kayıt Ol'
                size_hint_y: None
                height: dp(50)
                background_color: 0,0,0,0
                background_normal: ''
                color: 3/255, 115/255, 252/255, 1
                font_size: '18sp'
                on_release: app.root.ids.screen_manager.current = 'signup_screen'
                canvas.before:
                    Color:
                        rgba: 3/255, 115/255, 252/255, 1
                    Line:
                        width: 1.2
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(10))

