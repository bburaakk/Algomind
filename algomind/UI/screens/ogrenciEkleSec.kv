#:kivy 2.1.0
#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import Factory kivy.factory.Factory

# --- YENİ TASARIM İÇİN GEREKLİ STİLLER ---

<IconLabel@Label>:
    # DÜZELTME: İkonların doğru görünmesi için font adı düzeltildi.
    # Bu font dosyasının 'algomind/assets/' klasöründe olduğundan emin olun.
    font_name: 'algomind/assets/materialdesignicons-webfont.ttf'

<SearchBar@FloatLayout>:
    # DÜZELTME: TextInput buradan kaldırıldı. Sadece SearchBar'ın çerçevesi ve ikonu tanımlanıyor.
    size_hint_y: None
    height: dp(48)
    canvas.before:
        Color:
            rgba: get_color_from_hex('#E0E6ED')
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(24)]


# --- KALDIRILDI: Artık kullanılmayan FilterButton kuralı temizlendi. ---

<CircularImage@Widget>:
    source: ''
    size_hint: None, None
    size: dp(50), dp(50)
    canvas.before:
        StencilPush
        Ellipse:
            pos: self.pos
            size: self.size
        StencilUse
    canvas:
        Rectangle:
            source: root.source
            pos: self.pos
            size: self.size
    canvas.after:
        StencilUnUse
        Ellipse:
            pos: self.pos
            size: self.size
        StencilPop

<StudentCard@BoxLayout>:
    orientation: 'horizontal'
    padding: dp(12)
    spacing: dp(12)
    size_hint_y: None
    height: dp(74)
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12)]
    CircularImage:
        source: root.avatar_source
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: root.student_name
            font_name: 'algomind/assets/GochiHand-Regular.ttf'
            font_size: '16sp'
            color: get_color_from_hex('#1F2933')
            halign: 'left'
            text_size: self.size
        Label:
            text: root.student_id
            font_name: 'algomind/assets/GochiHand-Regular.ttf'
            font_size: '14sp'
            color: get_color_from_hex('#829AB1')
            halign: 'left'
            text_size: self.size

<PrimaryBottomButton@Button>:
    background_color: (0,0,0,0)
    background_normal: ''
    background_down: ''
    size_hint_y: None
    height: dp(55)
    canvas.before:
        Color:
            rgba: get_color_from_hex('#357ABD') if self.state == 'normal' else get_color_from_hex('#407dbf')
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12)]
    BoxLayout:
        pos: root.pos
        size: root.size
        padding: dp(15)
        Label:
            text: 'Yeni Öğrenci Ekle'
            font_name: 'algomind/assets/GochiHand-Regular.ttf'
            color: (1,1,1,1)
            font_size: '18sp'
        IconLabel:
            text: '\uF0142' # Chevron-right icon
            color: (1,1,1,1)
            font_size: '22sp'
            size_hint_x: None
            width: self.texture_size[0]

<SecondaryBottomButton@Button>:
    background_color: (0,0,0,0)
    background_normal: ''
    background_down: ''
    size_hint_y: None
    height: dp(55)
    canvas.before:
        Color:
            rgba: (1,1,1,1) if self.state == 'normal' else get_color_from_hex('#F0F4F8')
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12)]
    BoxLayout:
        pos: root.pos
        size: root.size
        padding: dp(15)
        Label:
            text: 'Test Sayfasına Geçiş'
            font_name: 'algomind/assets/GochiHand-Regular.ttf'
            color: get_color_from_hex('#52616B')
            font_size: '18sp'


# --- ÖĞRENCİ EKLEME FORMU İÇİN STİLLER ---

<FormSectionHeader@Label>:
    font_name: 'algomind/assets/GochiHand-Regular.ttf'
    font_size: '20sp'
    color: get_color_from_hex('#1E3A5F')
    bold: True
    size_hint_y: None
    height: self.texture_size[1]
    padding: [0, dp(20), 0, dp(20)]
    halign: 'left'
    text_size: self.width, None

<FormItemLabel@Label>:
    font_name: 'algomind/assets/GochiHand-Regular.ttf'
    font_size: '16sp'
    color: get_color_from_hex('#334E68')
    halign: 'left'
    valign: 'top'
    text_size: self.width, None
    padding: [0, dp(4), 0, 0]

# YENİ: Cinsiyet gibi seçenekler için özel etiket stili
<FormOptionLabel@Label>:
    font_name: 'algomind/assets/GochiHand-Regular.ttf'
    font_size: '16sp'
    color: get_color_from_hex('#334E68')
    halign: 'left'
    valign: 'middle'
    text_size: self.width, None

<FormWidgetContainer@BoxLayout>:
    size_hint_y: None
    height: dp(48)
    canvas.before:
        Color:
            rgba: (1, 1, 1, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(8)]
        Color:
            rgba: get_color_from_hex('#B0BEC5')
        Line:
            width: 1
            rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))

<FormTextInputWithHint@TextInput>:
    font_name: 'algomind/assets/GochiHand-Regular.ttf'
    font_size: '16sp'
    background_color: (0, 0, 0, 0)
    foreground_color: get_color_from_hex('#102A43')
    cursor_color: get_color_from_hex('#102A43')
    hint_text_color: get_color_from_hex('#829AB1')
    multiline: False
    padding: [dp(12), (self.height - self.line_height) / 2]

<CancelButton@Button>:
    font_name: 'algomind/assets/GochiHand-Regular.ttf'
    font_size: '18sp'
    background_normal: ''
    background_down: ''
    background_color: (0, 0, 0, 0)
    size_hint_y: None
    height: dp(55)
    canvas.before:
        Color:
            rgba: get_color_from_hex('#CFD8DC') if self.state == 'normal' else get_color_from_hex('#B0BEC5')
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(12)]

<TagLabel@Label>:
    size_hint: None, None
    size: self.texture_size[0] + dp(20), dp(32)
    font_name: 'algomind/assets/GochiHand-Regular.ttf'
    font_size: '14sp'
    color: get_color_from_hex('#102A43')
    canvas.before:
        Color:
            rgba: get_color_from_hex('#9FB3C8')
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(16)]

# --- ANA EKRAN ---

<OgrenciYonetimEkrani>:
    BoxLayout:
        orientation: 'vertical'
        ScreenManager:
            id: content_manager
            transition: Factory.FadeTransition(duration=0.2)

            # --- YENİ ÖĞRENCİ SEÇİM EKRANI ---
            Screen:
                name: 'secim_view'
                canvas.before:
                    Color:
                        rgba: get_color_from_hex('#F0F4F8') # Açık mavi/off-white
                    Rectangle:
                        pos: self.pos
                        size: self.size

                BoxLayout:
                    orientation: 'vertical'
                    padding: dp(15)
                    spacing: dp(15)

                    SearchBar:
                        TextInput:
                            id: search_input
                            hint_text: "Öğrencileri Ara..."
                            on_text: root.search_students(self.text)
                            pos_hint: {'center_y': 0.5}
                            x: self.parent.x + dp(50)
                            size_hint_x: 0.85
                            background_color: (0,0,0,0)
                            foreground_color: get_color_from_hex('#1F2933')
                            cursor_color: get_color_from_hex('#1F2933')
                            font_name: 'algomind/assets/GochiHand-Regular.ttf'
                            font_size: '16sp'
                            multiline: False

                    ScrollView:
                        bar_width: dp(8)
                        bar_color: get_color_from_hex('#357ABD')
                        GridLayout:
                            id: student_list_grid
                            cols: 2
                            spacing: dp(10)
                            padding: [0, dp(10)]
                            size_hint_y: None
                            height: self.minimum_height

                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(10)
                        PrimaryBottomButton:
                            on_release: root.ids.content_manager.current = 'ekle_view'
                        SecondaryBottomButton:
                            on_release: root.go_to_test_secim()

            # --- YENİ ÖĞRENCİ EKLEME EKRANI ---
            Screen:
                name: 'ekle_view'
                canvas.before:
                    Color:
                        rgba: get_color_from_hex('#F0F4F8')
                    Rectangle:
                        pos: self.pos
                        size: self.size

                ScrollView:
                    bar_width: dp(8)
                    bar_color: get_color_from_hex('#357ABD')
                    GridLayout:
                        cols: 1
                        spacing: dp(12)
                        padding: dp(25)
                        size_hint_y: None
                        height: self.minimum_height

                        FormSectionHeader:
                            text: "Kişisel Bilgiler"

                        FormItemLabel:
                            text: "Adı"
                        FormWidgetContainer:
                            FormTextInputWithHint:
                                id: ad_input
                                hint_text: "Adınızı girin"

                        FormItemLabel:
                            text: "Soyadı"
                        FormWidgetContainer:
                            FormTextInputWithHint:
                                id: soyad_input
                                hint_text: "Soyadınızı girin"

                        FormItemLabel:
                            text: "Yaş"
                        FormWidgetContainer:
                            FormTextInputWithHint:
                                id: yas_input
                                hint_text: "Yaşını girin"
                                input_filter: 'int'

                        # --- DÜZENLENEN BÖLÜM ---
                        FormItemLabel:
                            text: "Cinsiyet"
                        BoxLayout:
                            size_hint_y: None
                            height: dp(40)
                            spacing: dp(10)
                            padding: [dp(10), 0, 0, 0]

                            CheckBox:
                                id: cinsiyet_kadin
                                group: 'cinsiyet'
                                size_hint_x: None
                                width: dp(20)
                            FormOptionLabel:
                                text: "Kadın"

                            CheckBox:
                                id: cinsiyet_erkek
                                group: 'cinsiyet'
                                size_hint_x: None
                                width: dp(30)
                            FormOptionLabel:
                                text: "Erkek"
                        # --- DÜZENLEME BİTTİ ---

                        FormSectionHeader:
                            text: "Özel Bilgiler"

                        FormItemLabel:
                            text: "Hassasiyetleri"
                        FormWidgetContainer:
                            FormTextInputWithHint:
                                id: hassasiyet_input
                                hint_text: "Hassasiyetleri ekleyin"

                        FormItemLabel:
                            text: "Sevdiği Şeyler"
                        FormWidgetContainer:
                            FormTextInputWithHint:
                                id: sevdigi_seyler_input
                                hint_text: "Sevdiği şeyleri ekleyin"

                        FormItemLabel:
                            text: "Mevcut Eğitim Durumu"
                        FormWidgetContainer:
                            FormTextInputWithHint:
                                id: egitim_durumu_input
                                hint_text: "Eğitim durumunu girin"

                        FormItemLabel:
                            text: "İletişim Düzeyi"
                        FormWidgetContainer:
                            FormTextInputWithHint:
                                id: iletisim_duzeyi_input
                                hint_text: "İletişim düzeyini girin"

                        Widget:
                            size_hint_y: None
                            height: dp(20)

                        BoxLayout:
                            size_hint_y: None
                            height: dp(55)
                            spacing: dp(15)
                            Button:
                                text: "Öğrenciyi Ekle"
                                font_name: 'algomind/assets/GochiHand-Regular.ttf'
                                font_size: '18sp'
                                background_normal: ''
                                background_down: ''
                                background_color: (0,0,0,0)
                                on_release: root.add_student()
                                canvas.before:
                                    Color:
                                        rgba: get_color_from_hex('#357ABD')
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [dp(12)]
                            CancelButton:
                                text: "İptal"
                                on_release: root.ids.content_manager.current = 'secim_view'