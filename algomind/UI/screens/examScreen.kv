<TestScreen>:
    name: 'test_screen'

    MDBoxLayout:
        orientation: 'vertical'
        md_bg_color: get_color_from_hex('#F0F2F5') # Açık gri arka plan
        padding: dp(20)
        spacing: dp(15)

        # Üst Bar
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(60)
            spacing: dp(15)
            adaptive_height: True

            MDCard:
                md_bg_color: get_color_from_hex('#FFFFFF')
                radius: [dp(15),]
                padding: dp(10)
                MDLabel:
                    text: root.student_name
                    halign: 'center'
                    font_style: 'H6'
                    theme_text_color: 'Primary'

            MDCard:
                md_bg_color: get_color_from_hex('#FFFFFF')
                radius: [dp(15),]
                padding: dp(10)
                MDLabel:
                    text: root.formatted_time
                    halign: 'center'
                    font_style: 'H6'
                    theme_text_color: 'Primary'

        # Soru Sayacı
        MDLabel:
            id: question_counter
            text: root.question_counter_text
            halign: 'center'
            font_style: 'Body1'
            size_hint_y: None
            height: self.texture_size[1]
            theme_text_color: 'Secondary'

        # Ana İçerik Kartı (Şimdi bu kart, buton için yer bırakacak şekilde esnek olmalı)
        MDCard:
            orientation: 'vertical'
            # size_hint_y: 1 olarak bırakın, çünkü üstteki MDBoxLayout kalan alanı kaplayacak
            size_hint: 1, 1 
            md_bg_color: get_color_from_hex('#FFFFFF')
            radius: [dp(20),]
            padding: dp(20)
            spacing: dp(15)

            # Soru Metni
            MDLabel:
                id: question_text_label
                text: root.question_text
                halign: 'center'
                font_style: 'H5'
                size_hint_y: None
                height: self.texture_size[1]
                theme_text_color: 'Primary'

            # Resim/Soru İçerik Alanı
            MDBoxLayout:
                id: image_area
                size_hint_y: 0.6
                padding: dp(10)

            # Seçenekler Alanı
            MDBoxLayout:
                id: options_area
                orientation: 'horizontal'
                size_hint: (None, None)
                width: self.minimum_width
                height: self.minimum_height
                pos_hint: {'center_x': 0.5}
                spacing: dp(20)

                # --- TEST BUTONLARI ---
                MDRaisedButton:
                    text: "Seçenek A"
                MDRaisedButton:
                    text: "Seçenek B"
                # --- TEST BUTONLARI SONU ---

        # "Testi Bitir" butonu için yeni, ayrı bir alan
        MDBoxLayout:
            size_hint_y: None
            height: dp(60) # Buton için yeterli bir yükseklik ayarla
            padding: dp(10)
            pos_hint: {'center_x': 0.5} # Bu kutuyu ortala
            
            MDRaisedButton:
                text: "Testi Bitir"
                on_release: root.finish_test_early()
                md_bg_color: get_color_from_hex('#F44336') # Kırmızı renk
                size_hint_x: 1 # Kutu içinde tam genişlik kapla
                pos_hint: {'center_x': 0.5, 'center_y': 0.5} # Butonu kutu içinde ortala